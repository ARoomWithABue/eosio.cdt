
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>native tester Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc/page-toc.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-custom-header-next/swiper-3.4.2.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-custom-header-next/header.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-versions-minimal/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../tools/" />
    
    
    <link rel="prev" href="generator-attributes.html" />
    


    
        <link rel="shortcut icon" href='../images/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../images/favicon.ico' type="image/x-icon">
    
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="./">
            
                <a href="./">
            
                    
                    guides
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="cmake.html">
            
                <a href="cmake.html">
            
                    
                    cmake
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="first-smart-contract.html">
            
                <a href="first-smart-contract.html">
            
                    
                    first smart contract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="generator-attributes.html">
            
                <a href="generator-attributes.html">
            
                    
                    generator attributes
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.4" data-path="native-tester.html">
            
                <a href="native-tester.html">
            
                    
                    native tester
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../tools/">
            
                <a href="../tools/">
            
                    
                    tools
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../tools/eosio-abidiff.html">
            
                <a href="../tools/eosio-abidiff.html">
            
                    
                    eosio abidiff
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../tools/eosio-abigen.html">
            
                <a href="../tools/eosio-abigen.html">
            
                    
                    eosio abigen
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../tools/eosio-cpp.html">
            
                <a href="../tools/eosio-cpp.html">
            
                    
                    eosio cpp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../tools/eosio-init.html">
            
                <a href="../tools/eosio-init.html">
            
                    
                    eosio init
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../tools/eosio-ld.html">
            
                <a href="../tools/eosio-ld.html">
            
                    
                    eosio ld
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../upgrading/">
            
                <a href="../upgrading/">
            
                    
                    upgrading
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../upgrading/1.2-to-1.3.html">
            
                <a href="../upgrading/1.2-to-1.3.html">
            
                    
                    1.2 to 1.3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../upgrading/1.5-to-1.6.html">
            
                <a href="../upgrading/1.5-to-1.6.html">
            
                    
                    1.5 to 1.6
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../tmp/gitbook/index.md">
            
                <span>
            
                    
                    Browse
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >native tester</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="native-testercompilation">Native Tester/Compilation</h2>
<p>As of v1.5.0 native compilation can be performed and a new set of libraries to facilitate native testing and native &quot;scratch pad&quot; compilation.  <code>eosio-cc\cpp</code> and <code>eosio-ld</code> now support building &quot;smart contracts&quot; and unit tests natively for quick tests to help facilitate faster development (note the default implementations of eosio <code>intrinsics</code> are currently asserts that state they are unavailable, these are user definable.)</p>
<h4 id="getting-started">Getting Started</h4>
<p>Once you have your smart contract written then a test source file can be written.</p>
<p><code>hello.hpp</code></p>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;eosio/eosio.hpp&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> eosio;

CONTRACT hello : <span class="hljs-keyword">public</span> eosio::contract {
  <span class="hljs-keyword">public</span>:
      <span class="hljs-keyword">using</span> contract::contract;

      <span class="hljs-function">ACTION <span class="hljs-title">hi</span><span class="hljs-params">( name user )</span></span>;

      <span class="hljs-comment">// accessor for external contracts to easily send inline actions to your contract</span>
      <span class="hljs-keyword">using</span> hi_action = action_wrapper&lt;<span class="hljs-string">&quot;hi&quot;</span>_n, &amp;hello::hi&gt;;
};
</code></pre>
<p>and then a quick test
<code>hello_test.cpp</code></p>
<pre><code class="lang-c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;eosio/eosio.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;eosio/tester.hpp&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;hello.hpp&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> eosio;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> eosio::native;

EOSIO_TEST_BEGIN(hello_test)
   <span class="hljs-comment">// These can be redefined by the user to suit there needs per unit test</span>
   <span class="hljs-comment">// the idea is that in a future release we will have a base library that </span>
   <span class="hljs-comment">// initializes these to &quot;useable&quot; default implementations and probably </span>
   <span class="hljs-comment">// helpers to more easily define read_action_data and action_data_size intrinsics</span>
   <span class="hljs-comment">// like these&quot;</span>
   intrinsics::set_intrinsic&lt;intrinsics::read_action_data&gt;(
         [](<span class="hljs-keyword">void</span>* m, <span class="hljs-keyword">uint32_t</span> len) {
            check(len &lt;= <span class="hljs-keyword">sizeof</span>(eosio::name), <span class="hljs-string">&quot;failed from read_action_data&quot;</span>);
            *((eosio::name*)m) = <span class="hljs-string">&quot;hello&quot;</span>_n;
            <span class="hljs-keyword">return</span> len; 
         });

   intrinsics::set_intrinsic&lt;intrinsics::action_data_size&gt;(
         []() {
            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">uint32_t</span>)<span class="hljs-keyword">sizeof</span>(eosio::name);
         });

   intrinsics::set_intrinsic&lt;intrinsics::require_auth&gt;(
         [](capi_name nm) {
         });


   <span class="hljs-comment">// &quot;Name : hello&quot; should be in the print buffer</span>
   CHECK_PRINT(<span class="hljs-string">&quot;Name : hello&quot;</span>,
         []() {
            apply(<span class="hljs-string">&quot;test&quot;</span>_n.value, <span class="hljs-string">&quot;test&quot;</span>_n.value, <span class="hljs-string">&quot;hi&quot;</span>_n.value);
            });

   <span class="hljs-comment">// should not assert</span>
   apply(<span class="hljs-string">&quot;test&quot;</span>_n.value, <span class="hljs-string">&quot;test&quot;</span>_n.value, <span class="hljs-string">&quot;check&quot;</span>_n.value);

   name nm = <span class="hljs-string">&quot;null&quot;</span>_n;
   intrinsics::set_intrinsic&lt;intrinsics::read_action_data&gt;(
         [&amp;](<span class="hljs-keyword">void</span>* m, <span class="hljs-keyword">uint32_t</span> len) {
            check(len &lt;= <span class="hljs-keyword">sizeof</span>(eosio::name), <span class="hljs-string">&quot;failed from read_action_data&quot;</span>);
            *((eosio::name*)m) = nm;
            <span class="hljs-keyword">return</span> len; 
         });

   REQUIRE_ASSERT( <span class="hljs-string">&quot;check name not equal to `hello`&quot;</span>,
         []() {
            <span class="hljs-comment">// should assert</span>
            apply(<span class="hljs-string">&quot;test&quot;</span>_n.value, <span class="hljs-string">&quot;test&quot;</span>_n.value, <span class="hljs-string">&quot;check&quot;</span>_n.value);
            });

EOSIO_TEST_END

<span class="hljs-comment">// boilerplate main, this will be generated in a future release</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>{
   silence_output(<span class="hljs-literal">true</span>);
   EOSIO_TEST(hello_test);
   <span class="hljs-keyword">return</span> has_failed();
}
</code></pre>
<p>Every <code>intrinsic</code> that is defined for eosio (prints, require_auth, etc.) is redefinable given the <code>intrinsics::set_intrinsics&lt;intrinsics::the_intrinsic_name&gt;()</code> functions.  These take a lambda whose arguments and return type should match that of the intrinsic you are trying to define.  This gives the contract writer the flexibility to modify behavior to suit the unit test being written. A sister function <code>intrinsics::get_intrinsics&lt;intrinsics::the_intrinsic_name&gt;()</code> will return the function object that currently defines the behavior for said intrinsic.  This pattern can be used to mock functionality and allow for easier testing of smart contracts.  For more information please see, either the <code>./tests</code> directory or <code>./examples/hello/tests/hello_test.cpp</code> for working examples.</p>
<h3 id="compiling-native-code">Compiling Native Code</h3>
<ul>
<li>Raw <code>eosio-cpp</code> to compile the test or program the only addition needed to the command line is to add the flag <code>-fnative</code> this will then generate native code instead of <code>wasm</code> code.</li>
<li>Via CMake<ul>
<li><code>add_native_library</code> and <code>add_native_executable</code> CMake macros have been added (these are a drop in replacement for add_library and add_executable).</li>
</ul>
</li>
</ul>
<h3 id="eosiocdt-native-tester-api">Eosio.CDT Native Tester API</h3>
<ul>
<li>CHECK_ASSERT(...) : This macro will check whether a particular assert has occured and flag the tests as failed but allow the rest of the tests to run.  <ul>
<li>This is called either by <ul>
<li><code>CHECK_ASSERT(&quot;&lt;assert message&gt;&quot;, [](&lt;args&gt;){ whatever_function(&lt;args&gt;); })</code></li>
<li><code>CHECK_ASSERT([](std::string msg){ user defined comparison function }, [](&lt;args&gt;){ whatever_function(&lt;args&gt;); })</code></li>
</ul>
</li>
</ul>
</li>
<li>CHECK_PRINT(...) : This macro will check whether the print buffer holds the string that is expected and flag the tests as failed but allow the rest of the test to run.<ul>
<li>This is called either by <ul>
<li><code>CHECK_PRINT(&quot;&lt;print message&gt;&quot;, [](&lt;args&gt;){ whatever_function(&lt;args&gt;); })</code></li>
<li><code>CHECK_PRINT([](std::string print_buffer){ user defined comparison function }, [](&lt;args&gt;){ whatever_function(&lt;args&gt;); })</code></li>
</ul>
</li>
</ul>
</li>
<li>CHECK_EQUAL(X, Y) : This macro will check whether two inputs equal eachother and fail the test but allow the rest of the test to continue.</li>
<li>REQUIRE_ASSERT(...) : This macro will check whether a particular assert has occured and flag the tests as failed and halt the test on failure.  <ul>
<li>This is called either by <ul>
<li><code>REQUIRE_ASSERT(&quot;&lt;assert message&gt;&quot;, [](&lt;args&gt;){ whatever_function(&lt;args&gt;); })</code></li>
<li><code>REQUIRE_ASSERT([](std::string msg){ user defined comparison function }, [](&lt;args&gt;){ whatever_function(&lt;args&gt;); })</code></li>
</ul>
</li>
</ul>
</li>
<li>REQUIRE_PRINT(...) : This macro will check whether the print buffer holds the string that is expected and flag the tests as failed and halt the test on failure.<ul>
<li>This is called either by <ul>
<li><code>REQUIRE_PRINT(&quot;&lt;print message&gt;&quot;, [](&lt;args&gt;){ whatever_function(&lt;args&gt;); })</code></li>
<li><code>REQUIRE_PRINT([](std::string print_buffer){ user defined comparison function }, [](&lt;args&gt;){ whatever_function(&lt;args&gt;); })</code></li>
</ul>
</li>
</ul>
</li>
<li>REQUIRE_EQUAL(X, Y) : This macro will check whether two inputs <code>X</code> and <code>Y</code> equal eachother and fail the test and halt the test on failure.</li>
<li>EOSIO_TEST_BEGIN(X) : This macro defines the beginning of a unit test and assigns <code>X</code> as the symbolic name of that test.</li>
<li>EOSIO_TEST_END : This macro defines the end of a unit test.</li>
<li>EOSIO_TEST(X) : This is used to run a particular named unit test <code>X</code> in the main function.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="generator-attributes.html" class="navigation navigation-prev " aria-label="Previous page: generator attributes">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../tools/" class="navigation navigation-next " aria-label="Next page: tools">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"native tester","level":"1.2.4","depth":2,"next":{"title":"tools","level":"1.3","depth":1,"path":"tools/index.md","ref":"tools/index.md","articles":[{"title":"eosio abidiff","level":"1.3.1","depth":2,"path":"tools/eosio-abidiff.md","ref":"tools/eosio-abidiff.md","articles":[]},{"title":"eosio abigen","level":"1.3.2","depth":2,"path":"tools/eosio-abigen.md","ref":"tools/eosio-abigen.md","articles":[]},{"title":"eosio cpp","level":"1.3.3","depth":2,"path":"tools/eosio-cpp.md","ref":"tools/eosio-cpp.md","articles":[]},{"title":"eosio init","level":"1.3.4","depth":2,"path":"tools/eosio-init.md","ref":"tools/eosio-init.md","articles":[]},{"title":"eosio ld","level":"1.3.5","depth":2,"path":"tools/eosio-ld.md","ref":"tools/eosio-ld.md","articles":[]}]},"previous":{"title":"generator attributes","level":"1.2.3","depth":2,"path":"guides/generator-attributes.md","ref":"guides/generator-attributes.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["page-toc","custom-header-next@git+https://github.com/dskvr/gitbook-plugin-custom-header-next.git","versions-minimal@git+https://github.com/dskvr/gitbook-plugin-versions-minimal.git","favicon","toggle-chapters","nocache"],"pluginsConfig":{"nocache":{},"search":{},"page-toc":{"position":"before-first","selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4","showByDefault":true},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"versions-minimal":{"type":"branches","json":"/eosio.cdt/versions.json"},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"favicon":{"shortcut":"images/favicon.ico","bookmark":"images/favicon.ico"},"custom-header-next":{"logo":"/eosio.cdt/images/logo.png","logo_alt":"EOSIO","base_path":"/eosio.cdt","text":"eosio.cdt","navigations":[{"title":"Developers Portal","link":"http://developers.eos.io","id":"back-to-portal"}]},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"toggle-chapters":{}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"guides/native-tester.md","mtime":"2019-03-07T21:12:27.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-03-07T21:12:33.535Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/anchor-3.1.1.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/page-toc.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-custom-header-next/swiper-3.4.2.jquery.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-custom-header-next/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-versions-minimal/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-nocache/nocache.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

